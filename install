#!/bin/bash


if docker --version; 
then
  echo "Docker installed, ok"
else
  curl -sSL https://get.docker.com/ | sh
  echo "Docker has been installed"
  echo "Configure your user rights:"
  echo "   sudo usermod -a -G docker $USER"
  echo "   or : adduser $(whoami) docker"
fi

sudo echo "#!/bin/sh
exec sudo -E /usr/bin/docker \"\$@\"" > /usr/local/bin/docker
sudo chmod +x /usr/local/bin/docker

curl -sSL https://get.haskellstack.org/ | sh
stack update
stack upgrade

git clone https://gitlab.iscpif.fr/gargantext/haskell-gargantext.git

cd haskell-gargantext

git clone https://gitlab.iscpif.fr/gargantext/purescript-gargantext

mkdir deps
cd deps
git clone https://gitlab.iscpif.fr/gargantext/clustering-louvain.git
git clone https://github.com/np/servant-job.git
git clone https://github.com/np/patches-map
git clone https://gitlab.com/npouillard/patches-class.git
cd ..

stack docker pull
stack --docker setup
stack --docker build
stack --docker install


# Database configuration
# CREATE USER gargantua WITH PASSWORD $(grep DB_PASS gargantext.ini)
# GRANT ALL PRIVILEGES ON DATABASE gargandbV4 to gargantua
